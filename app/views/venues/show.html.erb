<% tabindex_on '#search_field' %>

<% content_for :discovery_insert do %>
  <link rel="alternate" type="application/x-wiki" title="Edit this page" href="<%= edit_venue_url(@venue) %>" />
<% end %>

<div class="single_venue contentbar">
  <a href="#" id="venue_sidebar_toggle" class="expander_toggle">Export or edit this venue...</a>
  <div id="venue_sidebar" class='single_view_right sidebar'>
    <div id='edit_link'>
      <p>
        You can <%= link_to "edit", edit_venue_url(@venue) %>
        or <%= link_to "delete", venue_url(@venue), :method => :delete, :confirm => "Are you sure?" %>
        this venue.
      </p>
    </div>
    <hr />
    <div class="metadata">
      <%= datestamp(@venue) %>
    </div>
    <hr />
    <div id="perso">
      <h3>Do you like this venue?</h3>
      <div>
        » Share it !<br/>
        <!-- AddToAny BEGIN -->
        <a class="a2a_dd" href="http://www.addtoany.com/share_save"><img src="http://static.addtoany.com/buttons/share_save_120_16.gif" width="120" height="16" border="0" alt="Share"/></a>
        <script type="text/javascript" src="http://static.addtoany.com/menu/page.js"></script>
        <!-- AddToAny END -->
      </div>

      <% if current_user %>
        <div>
          » Manage your favorites<br/>
          <div id="add_remove_favorite_venue">
            <%= image_tag '/images/loading.gif', :width => '24px', :height=> '24px', :style => "vertical-align:middle" %>&nbsp;Loading...
          </div>
        </div>
        <% javascript_tag do %>
          <%= remote_function(:update => "add_remove_favorite_venue", :url => {:controller  => :mypicalag, :action => :is_favorite_venue, :id => @venue.id}) %>
        <% end %>
      <% end %>

    </div>
  </div>

  <div class="location vcard<%= " closed" if @venue.closed? %>">
    <%= google_map @venue %>

    <h1 class="fn org"><%= cleanse @venue.title.strip_html %></h1>
    <% if @venue.closed? %><p class='closed_callout'>This venue is no longer open for business.</p><% end %>

    <% if @venue.has_full_address? %>
      <div class="adr">
        <% if @venue.street_address.present? %>
          <div class="street-address"><%=h @venue.street_address %></div>
        <% end %>
        <% if @venue.locality.present? %>
          <span class="locality"><%=h @venue.locality %></span><%= "," if @venue.region.present? or @venue.postal_code.present? or @venue.country.present? %>
        <% end %>
        <% if @venue.region.present? %>
          <span class="region"><%=h @venue.region %></span><%= "," if @venue.country.present? and not @venue.postal_code.present? %>
        <% end %>
        <% if @venue.postal_code.present? %>
          <span class="postal-code"><%=h @venue.postal_code %></span><%= "," if  @venue.country.present? %>
        <% end %>
        <% if @venue.country.present? %>
          <span class='country-name'><%=h @venue.country %></span>
        <% end %>
        (<a href='<%=google_maps_url(@venue.full_address) -%>'>map</a>)
      </div>
    <% else %>
      <% if @venue.address.present? %>
        <div class='address'>
          <%=h @venue.address %>
          (<a href='<%=google_maps_url(@venue.address) -%>'>map</a>)
        </div>
      <% end %>
    <% end %>
    <div class='info'>
      <% if @venue.url.present? %>
        <div class='url'><%= link_to(truncate(url_for(@venue.url), :length => 60), url_for(@venue.url), :rel => "nofollow") %></div>
      <% end %>

      <% if @venue.email.present? %>
        <div class='email'><%= mail_to( cleanse(@venue.email) ) %></div>
      <% end %>

      <% if @venue.telephone.present? %>
        <div class='tel'><%=h @venue.telephone %></div>
      <% end %>

      <% if @venue.wifi? %>
        <div class='wifi_callout'>Public WiFi</div>
      <% end %>
    </div>
  </div>

  <div>
    <% if @venue.description.present? || @venue.access_notes.present? %>
      <div class="description">
        <%= format_description(@venue.description) %>
        <% if @venue.access_notes.present? %>
          <div class="access_notes">
            <h3>Access Notes</h3>
            <%= h @venue.access_notes %>
          </div>
        <% end %>
      </div>
    <% end %>

    <% if @venue.tags.present? -%>
      <div class="tags">
        <h2>Tags</h2>
        <%= tag_links_for @venue %>
      </div>
    <% end %>

    <div id='future_events'>
      <h2>Future events happening here</h2>
      <%= render :partial => 'events/list', :locals => { :events => @events } %>
    </div>
  </div>
</div>
